# 虚拟商品充值

## 说明

商户上架自己的积分商品、虚拟礼品、游戏点数、VIP等级，发放奖品时，需实现这个接口，并将接口的URL配置在商户后台。

* 查询失败

由于网络异常等原因，可能导致请求获取虚拟商品兑换码失败，快抢平台对网络请求失败作了容错机制，失败的会通过一定的策略定期重新发起通知，尽可能提高通知的成功率。 （通知频率为15\/15\/30\/180\/1800\/1800\/1800\/1800\/3600，单位：秒），开发者需要加锁，以免引起重复执行。

注意：一个交易单号只能获取一个兑换码,如果为交易单号生成了兑换码，在重复执行时，则返回查询的结果。

* 形式： WebHook接口
* method： `POST`
* request:

| 参数名称 | 参数含义 | 数据类型 | 是否可选 | 参数说明 |
| :--- | :--- | :--- | :--- | :--- |
| out\_product\_no | 商户商品 | varchar\(20\) | 必填 | 商户的商品编号 |
| app_uid | 用户ID | String(60) | 可选 | 用户的唯一标识 |
| trans\_id | 交易单号 | String\(40\) | 必填 | 积分扣除时唯一的交易单号，开发者需要判断是否重复充值 |
| refer | 充值来源 | String\(10\) | 必填 | 充值来源类型，请参看“充值来源类型” |
| recharge\_time | 确认时间 | int\(11\) | 必填 | UNIX时间戳，开发者使用的对账时间 |
| user_account | 用户充值的账号 | varchar(20) | 可选 | 当设置商品的充值类型为“需填领奖号码”，用户领奖时需填写领奖号码|
| \_sign | 签名串 | String\(64\) | 必填 | 按签名规则生成的签名串 |

* 充值来源类型

| 值 | 描述 |
| --- | --- |
| 1 | 平台采购 |
| 2 | 商户自营 |

* response:

| 参数名称 | 参数含义 | 数据类型 | 是否可选 | 参数说明 |
| :--- | :--- | :--- | :--- | :--- |
| status | 数据状态 | Boolean | 必填 | 1:表示成功；0：表示失败 |
| cdkey | 兑换码 | String | 可选 | 兑换码 |
| message| 描述信息 | String | 可选 | 描述信息 |
| \_sign | 签名串 | String\(64\) | 必填 | 按签名规则生成的签名串 |

```
{
 "status":1,
 "cdkey":"asdasdadasdasdasd", // 礼包兑换码
 "message":"", // 错误的消息
 "_sign":"asdaddasdaqsign",
}
```



