# 加积分接口

## 说明

`限用户购买的免费商品`

由于快兑宝提供的夺宝的场景，支付成功后，用户可能发生以下交易情况：

（1）用户购买100人次，消耗100个积分，实际买到了50人次，这时需要退还用户50个积分；

（2）用户购买100人次，本商品开奖需要1000人次，在设置的过期时间后未达到开奖总需人次时，将需要退还用户100个积分；


`refer` 值为4，表示积分退还；

`trans_id`  表示 积分扣除时的单号，开发者可以参照扣除时单号做判断，避免错误的退还用户积分；


- 充值失败

失败的会通过一定的策略定期重新发起通知，尽可能提高通知的成功率。 （通知频率为15\/15\/30\/180\/1800\/1800\/1800\/1800\/3600，单位：秒），开发者需要加锁，以免引起重复执行。

* 形式： WebHook接口
* method： `POST`
* request:

| 参数名称 | 参数含义 | 数据类型 | 是否可选 | 参数说明 |
| :--- | :--- | :--- | :--- | :--- |
| app\_uid | 用户ID | String\(60\) | 必填 | 用户的唯一标识 |
| points | 充值积分 | int\(10\) | 必填 | 充值的积分数量 |
| out_product_no | 商品编号| int\(10\) | 必填 | 商户配置的商品 |
| trans\_id | 交易单号 | String\(40\) | 必填 | 积分扣除时唯一的交易单号，<br/>开发者需要判断是否重复充值；<br/> 交易失败时退还积分交易单号与扣除积分时交易单号一致 |
| type| 充值类型| String\(10\) | 必填 | 1-新手商品；2-普通商品；3-其它 |
| refer | 充值来源 | String\(10\) | 必填 | 充值来源类型，请参看“充值来源类型” |
| recharge_time | 确认时间 | int(11) | 必填 | UNIX时间戳，开发者使用的对账时间 |
| point_type | 积分类型 | int | 必填 | 默认为1，表示第一类积分 |
| \_sign | 签名串 | String\(64\) | 必填 | 按签名规则生成的签名串 |

* 充值来源类型

| 值 | 描述|
| --- | --- |
| 1 | 平台采购 |
| 2 | 商户自营 |
| 3 | 活动充值 |
| 4 | 积分退还 |
| 5 | 签到积分 |

* response:

`JSON`

| 参数名称 | 参数含义 | 数据类型 | 是否可选 | 参数说明 |
| :--- | :--- | :--- | :--- | :--- |
| status | 数据状态 | Boolean | 必填 | 1:表示成功；0：表示失败 2：表示重复充值 |
| message | 描述信息 | String | 可选 | 描述信息 |
| \_sign | 签名串 | String\(64\) | 必填 | 按签名规则生成的签名串 |

```
{
 "status":1,
 "message":"",
 "_sign":"asdaddasdaqsign",
}
```
